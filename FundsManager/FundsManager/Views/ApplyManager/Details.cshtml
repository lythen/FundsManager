@model FundsManager.ViewModels.ApplyListModel

@{
    ViewBag.Title = FundsManager.Controllers.SiteInfo.getSiteName() + "报销单详细信息";
    string thisRespondUser = "";
}
<style>
    .detail-table>tbody>tr>td,.th-table>tbody>tr>th{border:none;}
     .detail-table,.th-table{margin-bottom:0px;}
    .th-table>tbody>tr>th{padding-top:0px;padding-bottom:0px;}
    .txt-bold{font-weight:bold;}
    .content-table>tbody>tr>th,.th-table>tbody>tr>th,.respond-table>tbody>tr>th{background: lightblue;}
    .main-table td,.respond-table td,.content-table td{background-color: aliceblue;}
    .main-table .txt-bold{background: lightblue;}
    .detail-table td{background-color: aquamarine;}
    .table>tbody>tr>td, .table>tbody>tr>th, .table>tfoot>tr>td, .table>tfoot>tr>th, .table>thead>tr>td, .table>thead>tr>th {
        vertical-align: middle;
}
</style>

<h4>@Model.reimbursementCode - 报帐单详细信息</h4>
@using (Html.BeginForm())
{
    @Html.AntiForgeryToken()

    <div class="form-horizontal">
        <hr />
        @Html.ValidationSummary(true, "", new { @class = "text-danger" })
        @Html.HiddenFor(model => model.userId)
        @Html.HiddenFor(model => model.reimbursementCode)

        <div class="form-group">
            <label class="control-label col-md-2">基本信息</label>

            <div class="col-md-10">
                <table class="table main-table">
                    <tr>
                        <td class="txt-bold">填表人</td>
                        <td>@Html.DisplayFor(model => model.userName)</td>
                        <td class="txt-bold">填表时间</td>
                        <td>@Html.DisplayFor(model => model.time)</td>
                    </tr>
                    <tr>
                        <td class="txt-bold">报销金额</td>
                        <td>@Html.DisplayFor(model => model.amount) 元</td>
                        <td class="txt-bold">所选经费</td>
                        <td>@Html.DisplayFor(model => model.fundsName, new { htmlAttributes = new { Value = Model.fundsName + "(" + Model.fundsCode + ")" } })</td>
                    </tr>
                    <tr>
                        <td class="txt-bold">报销事由</td>
                        <td colspan="3">@Html.DisplayFor(model => model.info)</td>
                    </tr>
                </table>
            </div>
        </div>

        <div class="form-group">
            <label class="control-label col-md-2">报销内容</label>
            <div class="col-md-10">
                <table class="table content-table">
                    <tr>
                        <th>报销内容</th>
                        <th>报销金额</th>
                        <th>
                        <table class="table th-table">
                            <tr>
                                <th colspan="3" style="text-align:center;border-bottom:1px solid #ddd;">报销明细</th>
                            </tr>
                            <tr>
                                <th>时间</th>
                                <th>事项</th>
                                <th>金额</th>
                            </tr>
                        </table>
                        </th>
                    </tr>
                    @foreach (var item in Model.contents)
                    {
                        <tr id="tr_@item.contentId">
                            <td>
                                @Html.DisplayFor(citem => item.contentTitle, new { htmlAttributes = new { @class = "form-control" } })
                            </td>
                            <td>
                                @Html.DisplayFor(@citem => item.amount, new { htmlAttributes = new { @class = "form-control" } }) &nbsp;元
                            </td>
                            <td>
                                @if (item.details != null && item.details.Count() > 0)
                                {
                                    <table class="table detail-table">
                                        @foreach (var detail in item.details)
                                        {
                                            <tr>
                                                <td>
                                                   @Html.DisplayFor(ditem => detail.detailDate, new { htmlAttributes = new { value = ((DateTime)detail.detailDate).ToString("yyyy-MM-dd")}})
                                                    </td>
                                                <td>
                                                    @Html.DisplayFor(ditem => detail.detailInfo, new { htmlAttributes = new { @class = "form-control" } })
                                                </td>
                                                <td>
                                                    @Html.DisplayFor(ditem => detail.amount, new { htmlAttributes = new { @class = "form-control" } })

                                                </td>
                                            </tr>
                                        }
                                    </table>
                                }
                            </td>
                        </tr>

                    }
                </table>
            </div>
        </div>

        <div class="form-group">
            <label class="control-label col-md-2">附件</label>
            <div class="col-md-10">
                @if (Model.attachments != null && Model.attachments.Count() > 0)
                {
                    foreach (var aitem in Model.attachments)
                    {
                        string path = "../../attachments/" + Model.reimbursementCode + "/" + @aitem.fileName;
                        <div>
                            <span class="glyphicon glyphicon-paperclip"></span>
                            <a href="@path" attaid="@aitem.id" target="_blank" title="点击预览 @Path.GetFileName(aitem.fileName)" file="@aitem.fileName" class="det-attachment">@Path.GetFileName(aitem.fileName)</a>
                        </div>
                    }
                }
            </div>
        </div>
            <div class="form-group">
                <label class="control-label col-md-2" for="amount">审核情况</label>
                <div class="col-md-10">
                   @if (Model.responds != null && Model.responds.Count() > 0)
                   {
                       <table class="table respond-table">
                           <tr>
                               <th>审批人</th>
                               <th>结果</th>
                               <th>审批时间</th>
                               <th>备注</th>
                           </tr>
                           @foreach(var ritem in Model.responds)
                           {
                               if (thisRespondUser == "")
                               {
                                   if (ritem.state == 0)
                                   {
                                       thisRespondUser = ritem.respondUserId.ToString();
                                   }
                               }
                               <tr>
                                   <td>@Html.DisplayFor(Ritem => ritem.respondUser, new { htmlAttributes = new { @class = "form-control" } })</td>
                                   <td>@Html.DisplayFor(Ritem => ritem.strState, new { htmlAttributes = new { @class = "form-control" } })</td>
                                   <td>@Html.DisplayFor(Ritem => ritem.respondDate, new { htmlAttributes = new { @class = "form-control", Value = ritem.respondDate==null?"":((DateTime)ritem.respondDate).ToString("yyyy-MM-dd") } })</td>
                                   <td>@Html.DisplayFor(Ritem => ritem.reason, new { htmlAttributes = new { @class = "form-control" } })</td>
                               </tr>
                           }
                       </table>
                   }
                </div>
            </div>

        @if (thisRespondUser == User.Identity.Name)
        {
        <div class="form-group">
            <label class="control-label col-md-2" for="amount">审批操作</label>
            <div class="col-md-10">
                审核结果：
                备注：
            </div>
        </div>
        <div class="form-group">
            <label class="control-label col-md-2" for="amount">下一步审核批</label>
            <div class="col-md-10">
                @Html.DropDownListFor(model => Model.next, Model.next, ViewData["ViewUsers"] as List<SelectListItem>, null, new Dictionary<string, object> { { "class", "select form-control f-sel fl ddl-users" }, { "ID", "ddlUser" } })
                @Html.ValidationMessageFor(model => model.next, "", new { @class = "text-danger" })
            </div>
        </div>
        }
        <div class="form-group btn-div">
            <div class="col-md-offset-2 col-md-10">
                @if (thisRespondUser == User.Identity.Name)
                {
                    <button type="button" id="fat-btn" onclick="Add(this);" data-loading-text="加载中..." class="btn btn-primary" autocomplete="off">
                        提 交
                    </button>
                }
                @Html.ActionLink("返 回", "myFunds", null, new { @class = "btn btn-warning" })
            </div>
        </div>
    </div>
}